/*
Copyright (c) 2019 Daybrush
name: @scenejs/media
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/scenejs-media.git
version: 0.2.0
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("scenejs")):"function"==typeof define&&define.amd?define(["scenejs"],t):(e=e||self).MediaScene=t(e.Scene)}(this,function(e){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function r(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var s=function(i){function e(e){var t=i.call(this)||this;return t.isPlayMedia=!1,t.init(e),t}r(e,i);var t=e.prototype;return t.getMediaItem=function(){return this.mediaItem},t.getVolume=function(){return this.mediaItem.get(0,"volume")},t.setVolume=function(e){return this.mediaItem.set(0,"volume",e),this},t.setPlaySpeed=function(e){return this.mediaItem.setPlaySpeed(e),this},t.seek=function(e,t){var i=this.mediaItem;return i.set(0,"seek",e),i.set("100%","seek",t),i.setDuration(t-e),this},t.setElement=function(e){return this.mediaItem.setElement(e),this},t.getMediaElement=function(){return this.mediaItem.getElements()[0]},t.getInfo=function(){var e=this.mediaItem,t=[e.get(0,"seek"),e.get("100%","seek")],i=e.getPlaySpeed(),n=this.getVolume(),r=this.getDelay();return{url:this.url,seek:t,playSpeed:i,delay:r,volume:n}},t.init=function(e){var d=this,h=this.newItem("media");if(h.newFrame(0),h.newFrame(1),h.set(0,"volume",1),h.set(0,"seek",0),h.set("100%","seek",0),this.mediaItem=h,function(e){return"string"==typeof e}(e)){var t=new Audio;t.src=e,this.setElement(t),this.url=e}else{if(e.src)this.url=e.src;else{var i=e.querySelector("[src]");this.url=i?i.src:""}this.setElement(e)}var p=0;this.on("paused",function(e){var t;d.isPlayMedia=!1,null===(t=d.getMediaElement())||void 0===t||t.pause()}),this.on("animate",function(e){var t=d.getMediaElement(),i=e.time,n=i<p,r="running"===d.getPlayState(),s=-1<d.getDirection().indexOf("reverse"),a=d.isPlayMedia,o=e.frames.media,u=h.getPlaySpeed(),c=d.getDuration(),l=d.getVolume(),f=o.get("seek");if(p=i,r&&a||(t.playbackRate=u*(s?-1:1),t.currentTime=f),n||i<=0||c<=i)r&&(d.isPlayMedia=!1,t.pause());else if(t.volume=l,!a&&r){d.isPlayMedia=!0;var m=t.play();m instanceof Promise&&m.catch(function(){t.muted=!0,t.play()})}})},e}(e),t=function(t){function e(){var e=t.call(this)||this;return e.playInfos={},e}r(e,t);var i=e.prototype;return i.addMedia=function(e,t){void 0===t&&(t=e);var i=new s(t);return this.setItem(e,i),i},i.getInfo=function(){var t={duration:0,medias:[]};return this.forEach(function(e){t.medias.push(e.getInfo())}),t.duration=this.getDuration(),t},e}(e),i={Media:s,default:t};for(var a in i)t[a]=i[a];return t});
