/*
Copyright (c) Daybrush
name: @scenejs/media
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/scenejs-media.git
version: 0.2.2
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("scenejs")):"function"==typeof define&&define.amd?define(["scenejs"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).MediaScene=t(e.Scene)}(this,(function(e){"use strict";var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},t(e,i)};function i(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(e){function t(t){var i=e.call(this)||this;return i.isPlayMedia=!1,i.init(t),i}return i(t,e),t.prototype.getMediaItem=function(){return this.mediaItem},t.prototype.getVolume=function(){return this.mediaItem.get(0,"volume")},t.prototype.setVolume=function(e){return this.mediaItem.set(0,"volume",e),this},t.prototype.setPlaySpeed=function(e){return this.mediaItem.setPlaySpeed(e),this},t.prototype.seek=function(e,t){var i=this.mediaItem;return i.set(0,"seek",e),i.set("100%","seek",t),i.setDuration(t-e),this},t.prototype.setElement=function(e){return this.mediaItem.setElement(e),this},t.prototype.getMediaElement=function(){return this.mediaItem.getElements()[0]},t.prototype.getInfo=function(){var e=this.mediaItem,t=[e.get(0,"seek"),e.get("100%","seek")],i=e.getPlaySpeed(),n=this.getVolume(),r=this.getDelay();return{url:this.url,seek:t,playSpeed:i,delay:r,volume:n}},t.prototype.init=function(e){var t=this,i=this.newItem("media");if(i.newFrame(0),i.newFrame(1),i.set(0,"volume",1),i.set(0,"seek",0),i.set("100%","seek",0),this.mediaItem=i,"string"==typeof e){var n=new Audio;n.src=e,this.setElement(n),this.url=e}else{if(e.src)this.url=e.src;else{var r=e.querySelector("[src]");this.url=r?r.src:""}this.setElement(e)}var o=0;this.on("paused",(function(e){var i;t.isPlayMedia=!1,null===(i=t.getMediaElement())||void 0===i||i.pause()})),this.on("animate",(function(e){var n=t.getMediaElement(),r=e.time,s=o>r,a="running"===t.getPlayState(),u=t.getDirection().indexOf("reverse")>-1,l=t.isPlayMedia,f=e.frames.media,c=i.getPlaySpeed(),p=t.getDuration(),m=t.getVolume(),d=f.get("seek");if(o=r,a&&l||(n.playbackRate=c*(u?-1:1),n.currentTime=d),s||r<=0||p<=r)a&&(t.isPlayMedia=!1,n.pause());else if(n.volume=m,!l&&a){t.isPlayMedia=!0;var h=n.play();h instanceof Promise&&h.catch((function(){n.muted=!0,n.play()}))}}))},t}(e),r=function(e){function t(){var t=e.call(this)||this;return t.playInfos={},t}return i(t,e),t.prototype.addMedia=function(e,t){void 0===t&&(t=e);var i=new n(t);return this.setItem(e,i),i},t.prototype.getInfo=function(){var e={duration:0,medias:[]};return this.forEach((function(t){e.medias.push(t.getInfo())})),e.duration=this.getDuration(),e},t}(e),o={__proto__:null,Media:n,default:r};for(var s in o)r[s]=o[s];return r}));
//# sourceMappingURL=media.min.js.map
